# JobMitra Project - Copilot Full Instructions

## Project Overview

**JobMitra** is a Next.js project with three main user roles:

- **Admin**: Manages users (employers, talents), performs CRUD, and views all users.
- **Employer**: Can manage their own jobs, view applicants, and interact with the platform.
- **Talent**: Can manage their profile, apply for jobs, and see relevant content.

The project structure:

/root
├─ context/
│ └─ AuthContext.ts # AuthProvider + useAuth hook for authentication and global user state
├─ lib/
│ ├─ actions/ # UI actions calling API endpoints
│ └─ api/
│ ├─ auth.ts # User authentication API calls
│ └─ admin.ts # Admin API calls
├─ proxy.ts # Middleware for frontend route protection (role-based)
├─ pages/ or app/ # Next.js pages or layouts


---

## How the App Works

1. UI Components call functions in `lib/actions`.
2. `actions` call API wrapper functions in `lib/api` (`auth.ts` or `admin.ts`) → backend endpoints.
3. `AuthContext` holds:
   - `user`
   - `isAuthenticated`
   - `loading`
   - `logout`
   - `checkAuth`
   - `setUser`, `setIsAuthenticated`  
   Components must read and update `AuthContext` instead of directly using cookies.
4. `proxy.ts` is **frontend route protection** based on `role`:
   - Admin pages (`/admin`) → only `user.role === 'admin'`.
   - User pages (`/user`) → only `user.role === 'user'` or admin.
   - Public pages (`/login`, `/register`) → redirect logged-in users to `/` or their dashboard.
5. Backend API endpoints already verify tokens and roles; **frontend context does not replace backend security**.

---

## Rules for Copilot

1. **Always use `AuthContext`** for auth state in UI components (login, logout, role checks).
2. After successful API calls in `actions`:
   - Update `AuthContext` if the call changes logged-in user info (e.g., login, logout).
   - Example: `setUser()` and `setIsAuthenticated()` after login.
3. **Frontend CRUD flow**:
   - UI → `actions` → API (`lib/api`) → update `AuthContext` if necessary → UI update.
4. **Role-based rendering**:
   - Admin pages: render only if `user.role === 'admin'`.
   - Talent/Employer pages: render only if `user.role === 'user'` or `user.role === 'admin'`.
   - Always redirect unauthorized users.
5. **Do not manipulate cookies directly in UI components**. Only `AuthContext` or `lib/actions` should handle token storage.
6. **When generating new pages/components**:
   - Always integrate with `AuthContext` for auth and user info.
   - Use `lib/actions` to call API endpoints.
   - Do not call backend endpoints directly from components.
7. **Example flows**:

### Login Flow
```ts
const loginAction = async (email, password) => {
  const response = await auth.login(email, password);
  setUser(response.user);
  setIsAuthenticated(true);
  redirectBasedOnRole(response.user.role);
};
